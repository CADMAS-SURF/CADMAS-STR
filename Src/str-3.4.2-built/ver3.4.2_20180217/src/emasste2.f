      SUBROUTINE EMASSTE2(EMASS,AMAT,GRID,KN,LUMP,ITO)
C
C     EMASS : OUT : 要素質量行列
C     AMAT  : IN  : 物性テーブル
C     GRID  : IN  : 節点座標
C     KN    : IN  : 要素の構成節点番号
C     LUMP  : IN  : =0:lumped mass, =1:consistent mass
C
      IMPLICIT REAL*8(A-H,O-Z)
      DIMENSION WGT(15),RL(4,15),XYZ(3,10),GRID(3,*),KN(10),AMAT(*)
     &         ,EMASS(10,10),P(3,10),H(10),HTH(10,10)
      DATA WGT /   0.019753086419753D0, 4*0.011989513963170D0,
     &           4*0.011511367871045D0, 6*0.008818342151675D0 /
      DATA RL  / 4*0.25D0,
     &    0.091971078052723D0, 0.091971078052723D0, 0.091971078052723D0,
     &    0.724086765841831D0,
     &    0.091971078052723D0, 0.091971078052723D0, 0.724086765841831D0,
     &    0.091971078052723D0,
     &    0.091971078052723D0, 0.724086765841831D0, 0.091971078052723D0,
     &    0.091971078052723D0,
     &    0.724086765841831D0, 0.091971078052723D0, 0.091971078052723D0,
     &    0.091971078052723D0,
     &    0.319793627829630D0, 0.319793627829630D0, 0.319793627829630D0,
     &    0.040619116511110D0,
     &    0.319793627829630D0, 0.319793627829630D0, 0.040619116511110D0,
     &    0.319793627829630D0,
     &    0.319793627829630D0, 0.040619116511110D0, 0.319793627829630D0,
     &    0.319793627829630D0,
     &    0.040619116511110D0, 0.319793627829630D0, 0.319793627829630D0,
     &    0.319793627829630D0,
     &    0.056350832689629D0, 0.056350832689629D0, 0.443649167310371D0,
     &    0.443649167310371D0,
     &    0.056350832689629D0, 0.443649167310371D0, 0.056350832689629D0,
     &    0.443649167310371D0,
     &    0.443649167310371D0, 0.056350832689629D0, 0.056350832689629D0,
     &    0.443649167310371D0,
     &    0.056350832689629D0, 0.443649167310371D0, 0.443649167310371D0,
     &    0.056350832689629D0,
     &    0.443649167310371D0, 0.056350832689629D0, 0.443649167310371D0,
     &    0.056350832689629D0,
     &    0.443649167310371D0, 0.443649167310371D0, 0.056350832689629D0,
     &    0.056350832689629D0 /
C----&------------------------------------------------------------------
      DO 100 I=1,10
        CALL SHIFT1(XYZ(1,I),GRID(1,KN(I)),3)
  100 CONTINUE
C
      RHO=AMAT(3)
C
      CALL CLEAR1(EMASS,100)
      VOL=0.
C
      DO 200 I=1,15
        CALL SFNTE2(RL(1,I),H)
        CALL DERTE2(RL(1,I),P)
        CALL DET3(DET,10,P,XYZ,ITO)
        IF( LUMP .EQ. 0 ) THEN
          VOL=VOL+WGT(I)*DET
          CALL RMULT3(EMASS,H,WGT(I)*DET,10)
        ELSE
          CALL AXB(HTH,H,H,10,1,10)
          CALL RMULT2(EMASS,HTH,WGT(I)*RHO*DET,100)
        ENDIF
  200 CONTINUE
C
      IF( LUMP .EQ. 0 ) THEN
        CALL SUMVEC(EMASST,EMASS,10)
        CALL RMULT1(EMASS,EMASS,RHO*VOL/EMASST,10)
      ENDIF
C
      RETURN
      END
